#!/bin/bash

TOOLCHAINS_DIR="${HOME}/works/android/generic/toolchains"

TOOLCHAIN_BIN=$( android_toolchain | cut -d'|' -f1 )
TOOLCHAIN=$( android_toolchain | cut -d'|' -f2 )

if [ ! -z ${USE_CCACHE+x} ]; then
	if [ $USE_CCACHE -eq 1 ]; then
		export PATH="${TOOLCHAINS_DIR}/${TOOLCHAIN}/bin":${PATH}

		TOOLCHAIN="ccache"
	fi
fi

export CROSS_COMPILE="${TOOLCHAINS_DIR}/${TOOLCHAIN}/bin/${TOOLCHAIN_BIN}"

export KERNEL=$(pwd)
export ARCH=arm64
export SUBARCH=arm64
export KBUILD_BUILD_USER="thewisenerd"
export KBUILD_BUILD_HOST="eniac"

rm -rf std*.log

exec make "$@" # > >(tee stdout.log) 2> >(tee stderr.log >&2)
