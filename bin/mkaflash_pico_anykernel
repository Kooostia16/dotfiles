#!/bin/sh
##               mkaflash              ##
## get a flashable zip for your zImage ##
## uses: cpmodules (thewisenerd (contact.twn@openmailbox.org))
## uses: zImage-helper (thewisenerd (contact.twn@openmailbox.org))

zIMAGE=/home/thewisenerd/works/AnyKernel2/

#cpmodules
cpmodules  > /dev/null 2> /dev/null;

#files
#mv ./workspace ${zIMAGE}workspace;

#rearrange
mv workspace/zImage ${zIMAGE}zImage;
#rm -rf ${zIMAGE}system/lib/modules;
mv workspace/modules/* ${zIMAGE}/modules/;

#cleanup
#workspace
#rm -rf ${zIMAGE}workspace

#zippit
(cd ${zIMAGE}; zip -r -y -q kernel.zip * -x *.zip* *placeholder build README .gitignore .git);

#get output.zip
mv ${zIMAGE}kernel.zip ./output.zip;

(cd ${zIMAGE}; git clean -f -x -d && git reset --hard ) > /dev/null 2> /dev/null;

#cleanup
#rm -rf ${zIMAGE}zImage
#rm -rf ${zIMAGE}system/lib/modules;
#mkdir -p ${zIMAGE}system/lib/modules;

#readd place_holder
#touch ${zIMAGE}system/lib/modules/place_holder;


